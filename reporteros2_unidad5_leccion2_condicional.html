<script>
// ====== ACT 5 (new): Dropdown — choose the correct conditional ======
const A5_ITEMS_NEW = [
  { prompt:"Yo ___ (ahorrar) electricidad para ayudar al planeta.", options:["ahorraría","ahorrarías","ahorrarían"], correct:"ahorraría" },
  { prompt:"Ellos ___ (construir) parques el año que viene.", options:["construiría","construiríamos","construirían"], correct:"construirían" },
  { prompt:"Nosotros ___ (poder) reciclar más en el barrio.", options:["podrías","podríamos","podrían"], correct:"podríamos" },
  { prompt:"Tú ___ (proteger) el bosque con más voluntarios.", options:["protegerías","protegerían","protegería"], correct:"protegerías" },
  { prompt:"La ciudad ___ (pagar) menos con energía solar.", options:["pagaría","pagarías","pagaríamos"], correct:"pagaría" },
  { prompt:"Los ingenieros ___ (decir) que es sostenible.", options:["diría","dirías","dirían"], correct:"dirían" },
  { prompt:"Nosotros ___ (instalar) paneles solares en la escuela.", options:["instalaríamos","instalaríais","instalarían"], correct:"instalaríamos" },
  { prompt:"¿Tú ___ (explicar) el plan de energía renovable?", options:["explicaría","explicarías","explicarían"], correct:"explicarías" }
];

function buildA5(){
  const c = document.getElementById('a5List');
  c.innerHTML = '';
  // Randomize item order and option order for each item
  const items = A5_ITEMS_NEW.slice();
  for (let i = items.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i+1));
    [items[i], items[j]] = [items[j], items[i]];
  }
  items.forEach((it, idx) => {
    const opts = it.options.slice().sort(()=>Math.random()-0.5);
    const row = document.createElement('div');
    row.className = 'q';
    row.dataset.correct = it.correct;
    row.innerHTML = `
      <div>${idx+1}) ${it.prompt}</div>
      <div class="small" style="margin-top:6px">
        <select class="a5sel">${opts.map(o=>`<option>${o}</option>`).join('')}</select>
      </div>
      <div class="feedback small"></div>
    `;
    c.appendChild(row);
  });
  document.getElementById('a5Score').textContent = 'Correctos: 0 / ' + A5_ITEMS_NEW.length;
}

document.getElementById('a5Check').addEventListener('click', () => {
  // Reuse the global totalChecks if present
  try { totalChecks++; } catch(e){}
  let score = 0;
  document.querySelectorAll('#a5List .q').forEach(row => {
    const sel = row.querySelector('.a5sel').value;
    const fb = row.querySelector('.feedback');
    if (sel === row.dataset.correct) {
      row.classList.add('correct'); row.classList.remove('incorrect');
      fb.innerHTML = '<span class="good">✅</span>';
      score++;
    } else {
      row.classList.add('incorrect'); row.classList.remove('correct');
      fb.innerHTML = `<span class="bad">→ ${row.dataset.correct}</span>`;
      // Fade out feedback after 3s
      setTimeout(()=>{ fb.classList.add('fade-out'); setTimeout(()=>{ fb.classList.remove('fade-out'); fb.textContent=''; }, 650); }, 3000);
    }
  });
  document.getElementById('a5Score').textContent = `Correctos: ${score} / ${A5_ITEMS_NEW.length}`;
});

document.getElementById('a5Reset').addEventListener('click', buildA5);

// If your initAll() already calls buildA5(), this is not needed here.
// Otherwise, call buildA5() once at load time:
try { if (typeof initAll === 'undefined') buildA5(); } catch(e){}
</script>
