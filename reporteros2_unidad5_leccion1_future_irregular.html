<!DOCTYPE html>
<html lang="es"><head><meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Futuro — Irregulares</title>
<style>
:root{--bg:#f7fafc;--card:#ffffff;--ink:#0f172a;--muted:#475569;--accent:#0ea5e9;--ok:#16a34a;--warn:#f59e0b}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;line-height:1.45}
header{padding:18px 16px;background:linear-gradient(90deg,#0ea5e9,#22c55e);color:white;display:flex;align-items:center;gap:12px;flex-wrap:wrap}
header .brand{font-weight:900;letter-spacing:.5px;background:rgba(255,255,255,.15);padding:4px 10px;border-radius:999px}
header h1{margin:0;font-size:1.1rem}
header p{margin:.25rem 0 0 0;opacity:.95}
.wrap{max-width:980px;margin:20px auto;padding:0 12px}
.card{background:var(--card);border-radius:14px;box-shadow:0 6px 20px rgba(2,6,23,.08);padding:16px;margin:16px 0}
.row{display:flex;gap:14px;flex-wrap:wrap}
.col{flex:1 1 340px}
.muted{color:var(--muted);font-size:.95rem}
.stage{border-left:6px solid var(--accent);padding-left:12px;margin-top:10px}
.stage h2{margin:.2rem 0 .6rem;font-size:1.1rem}
.q{margin:10px 0;padding:12px;border:1px solid #e2e8f0;border-radius:12px;background:#fff}
.q.correct{border-color:#86efac;background:#f0fdf4}
.q.incorrect{border-color:#fecaca;background:#fff7f7}
.foot{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.small{font-size:.85rem}
button{border:0;background:var(--accent);color:white;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700}
button.ghost{background:#e2e8f0;color:#111827}
button.ok{background:var(--ok)}
button.warn{background:#f59e0b}
.chips{display:flex;flex-wrap:wrap;gap:8px;max-height:180px;overflow-y:auto;padding-right:4px}
.tile{padding:8px 10px;background:#eef2ff;border:1px solid #c7d2fe;border-radius:10px;cursor:grab;user-select:none}
.tile.selected{outline:3px solid #0ea5e9;background:#e0f2fe}
.bin{min-height:72px;padding:10px;border:2px dashed #cbd5e1;border-radius:12px;background:#f8fafc;margin:6px 0;display:flex;flex-wrap:wrap;gap:8px}
.key{display:none;margin-top:6px;font-size:.9rem;color:#2563eb}
.score{font-weight:800}
.kbd{font-family:ui-monospace, Menlo, Consolas, monospace;background:#f1f5f9;border:1px solid #e2e8f0;border-bottom-width:3px;padding:2px 6px;border-radius:6px}
input[type="text"]{padding:6px 8px;border-radius:8px;border:1px solid #cbd5e1;font-size:16px;vertical-align:baseline}
.inline-blank{display:inline-block;margin:0 .25rem}
.smallmono{font-size:.85rem;font-family:ui-monospace,Menlo,Consolas,monospace;color:#0f766e}
</style></head><body>
<header>
  <span class="brand">ProfeVT</span>
  <h1>Futuro — Irregulares</h1>
  <p>Nombre: <input id="studentName" type="text" placeholder="Escribe tu nombre..." style="max-width:320px;margin-left:8px" /></p>
</header>
<div class="wrap">
  <div class="card">
    <div class="row">
      <div class="col"><p class="muted">Irregulares: <span class="smallmono">tendr-, vendr-, podr-, querr-, har-, dir-, pondr-, saldr-, sabr-</span>. Usa <span class="kbd">?teacher=1</span> para ver modelos + glosas.</p></div>
      <div class="col">
        <div class="foot small">
          <button id="checkAll" class="ok">Calificar todo</button>
          <button id="resetAll" class="ghost">Reiniciar</button>
          <button id="exportCSV" class="warn">Descargar resultados (.csv)</button>
          <span>Puntaje total: <span id="totalScore" class="score">0</span> / <span id="totalMax">0</span></span>
        </div>
      </div>
    </div>
  </div>

<div class="card stage" id="stage1">
  <h2>Etapa 1 — ¿Futuro irregular o presente?</h2>
  <p class="muted">Arrastra o haz clic para clasificar.</p>
  <div class="q" id="s1q">
    <div class="chips" id="s1Bank"></div>
    <div style="display:flex; gap:12px; flex-wrap:wrap">
      <div class="col"><strong>Futuro irregular</strong><div class="bin" id="s1Good"></div></div>
      <div class="col"><strong>Presente</strong><div class="bin" id="s1Bad"></div></div>
    </div>
    <div class="key" id="s1Key"></div>
  </div>
  <div class="foot small">
    <button class="ok" onclick="gradeS1()">Calificar Etapa 1</button>
    <span>Puntaje: <span id="s1Score" class="score">0</span> / <span id="s1Max">0</span></span>
  </div>
</div>

<div class="card stage" id="stage2">
  <h2>Etapa 2 — Conjuga en futuro (irregular)</h2>
  <div id="s2Container"></div>
  <div class="foot small">
    <button class="ok" onclick="gradeS2()">Calificar Etapa 2</button>
    <span>Puntaje: <span id="s2Score" class="score">0</span> / <span id="s2Max">0</span></span>
  </div>
</div>

<div class="card stage" id="stage3">
  <h2>Etapa 3 — Completa en contexto (cloze)</h2>
  <p class="muted">Escribe la forma en <strong>futuro</strong> en el lugar correcto.</p>
  <div id="s3Container"></div>
  <div class="foot small">
    <button class="ok" onclick="gradeS3()">Calificar Etapa 3</button>
    <span>Puntaje: <span id="s3Score" class="score">0</span> / <span id="s3Max">0</span></span>
  </div>
</div>

<div class="card stage" id="stage4">
  <h2>Etapa 4 — Constructor de oraciones</h2>
  <p class="muted">Ordena las piezas para formar una oración lógica con futuro irregular.</p>
  <div id="s4Container"></div>
  <div class="foot small">
    <button class="ok" onclick="gradeS4()">Calificar Etapa 4</button>
    <span>Puntaje: <span id="s4Score" class="score">0</span> / <span id="s4Max">0</span></span>
  </div>
</div>

</div>
<script>

const teacherMode = new URLSearchParams(location.search).get('teacher')==='1';
function shuffle(a){a=a.slice();for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
function norm(s){return (s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim();}
function applyTeacher(){ if(teacherMode){ document.querySelectorAll('.key').forEach(k=>k.style.display='block'); } }
let selectedTile = null;
function makeTileInteractive(tile){
  tile.addEventListener('dragstart', ()=>{ selectedTile = tile; tile.classList.add('selected'); });
  tile.addEventListener('click', ()=>{
    if(selectedTile && selectedTile!==tile){ selectedTile.classList.remove('selected'); }
    if(tile.classList.contains('selected')){ tile.classList.remove('selected'); selectedTile=null; }
    else { tile.classList.add('selected'); selectedTile = tile; }
  });
}
function makeBinInteractive(bin){
  bin.addEventListener('dragover', e=>e.preventDefault());
  bin.addEventListener('drop', e=>{ e.preventDefault(); if(selectedTile){ bin.appendChild(selectedTile); selectedTile.classList.remove('selected'); selectedTile=null; }});
  bin.addEventListener('click', ()=>{ if(selectedTile){ bin.appendChild(selectedTile); selectedTile.classList.remove('selected'); selectedTile=null; }});
}
function exportCSVGeneric(filename, headers, row){
  const ts=new Date().toISOString();
  const name=(document.querySelector('#studentName').value||'').replace(/,/g,' ');
  const blob=new Blob([headers+"\n"+[ts,name].concat(row).join(',')],{type:"text/csv"});
  const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=filename;
  document.body.appendChild(a); a.click(); setTimeout(()=>{URL.revokeObjectURL(url); a.remove();},500);
}


const S1_GOOD = ["Yo tendré tiempo para ser voluntario.", "Tú saldrás temprano para la manifestación.", "Él podrá reciclar más mañana.", "Nosotros querremos ayudar al ecosistema.", "Vosotros sabréis usar la energía renovable.", "Ellos pondrán paneles solares en la escuela."];
const S1_BAD  = ["Yo tengo tiempo para ser voluntario.", "Tú sales temprano para la manifestación.", "Él puede reciclar más mañana.", "Nosotros queremos ayudar al ecosistema.", "Vosotros sabéis usar la energía renovable.", "Ellos ponen paneles solares en la escuela."];
const S2_ITEMS = [{"subj": "yo", "inf": "tener", "ans": "tendré", "opts": ["tendré", "tendras", "tendra", "tendran", "tendre", "tendre"]}, {"subj": "tú", "inf": "venir", "ans": "vendrás", "opts": ["vendrás", "vendras", "vendra", "vendran", "vendre", "vendras"]}, {"subj": "él", "inf": "poder", "ans": "podrá", "opts": ["podrá", "podras", "podra", "podran", "podre", "podra"]}, {"subj": "nosotros", "inf": "querer", "ans": "querremos", "opts": ["querremos", "querras", "querra", "querran", "querre", "querremos"]}, {"subj": "vosotros", "inf": "hacer", "ans": "haréis", "opts": ["haréis", "haras", "hara", "haran", "hare", "hareis"]}, {"subj": "ellos", "inf": "decir", "ans": "dirán", "opts": ["dirán", "diras", "dira", "diran", "dire", "diran"]}, {"subj": "yo", "inf": "poner", "ans": "pondré", "opts": ["pondré", "pondras", "pondra", "pondran", "pondre", "pondre"]}, {"subj": "tú", "inf": "salir", "ans": "saldrás", "opts": ["saldrás", "saldras", "saldra", "saldran", "saldre", "saldras"]}, {"subj": "él", "inf": "saber", "ans": "sabrá", "opts": ["sabrá", "sabras", "sabra", "sabran", "sabre", "sabra"]}, {"subj": "nosotros", "inf": "tener", "ans": "tendremos", "opts": ["tendremos", "tendras", "tendra", "tendran", "tendre", "tendremos"]}, {"subj": "vosotros", "inf": "venir", "ans": "vendréis", "opts": ["vendréis", "vendras", "vendra", "vendran", "vendre", "vendreis"]}, {"subj": "ellos", "inf": "poder", "ans": "podrán", "opts": ["podrán", "podras", "podra", "podran", "podre", "podran"]}, {"subj": "yo", "inf": "querer", "ans": "querré", "opts": ["querré", "querras", "querra", "querran", "querre", "querre"]}, {"subj": "tú", "inf": "hacer", "ans": "harás", "opts": ["harás", "haras", "hara", "haran", "hare", "haras"]}, {"subj": "él", "inf": "decir", "ans": "dirá", "opts": ["dirá", "diras", "dira", "diran", "dire", "dira"]}, {"subj": "nosotros", "inf": "poner", "ans": "pondremos", "opts": ["pondremos", "pondras", "pondra", "pondran", "pondre", "pondremos"]}, {"subj": "vosotros", "inf": "salir", "ans": "saldréis", "opts": ["saldréis", "saldras", "saldra", "saldran", "saldre", "saldreis"]}, {"subj": "ellos", "inf": "saber", "ans": "sabrán", "opts": ["sabrán", "sabras", "sabra", "sabran", "sabre", "sabran"]}];
const S3_ITEMS = [{"txt": "Mañana yo ___ (tener) más tiempo para ayudar.", "ans": "tendré"}, {"txt": "Esta noche tú ___ (venir) a la reunión ciudadana.", "ans": "vendrás"}, {"txt": "El sábado él ___ (poder) limpiar la playa.", "ans": "podrá"}, {"txt": "Nosotros ___ (querer) proteger el ecosistema.", "ans": "querremos"}, {"txt": "Vosotros ___ (saber) dónde reciclar mejor.", "ans": "sabréis"}, {"txt": "Ellos ___ (poner) paneles solares en casa.", "ans": "pondrán"}, {"txt": "Yo ___ (hacer) un plan sostenible para la escuela.", "ans": "haré"}, {"txt": "Tú ___ (decir) tus ideas al guía.", "ans": "dirás"}, {"txt": "En 2030 la ciudad ___ (tener) menos contaminación.", "ans": "tendrá"}, {"txt": "Si ahorramos energía, todos ___ (poder) pagar menos.", "ans": "podrán"}];
const S4_ITEMS = [{"tokens": ["Si", "tenemos", "tiempo,", "haremos", "un", "plan", "sostenible."], "key": "Si tenemos tiempo, haremos un plan sostenible."}, {"tokens": ["Si", "pueden", "venir,", "ellos", "dirán", "sus", "propuestas."], "key": "Si pueden venir, ellos dirán sus propuestas."}, {"tokens": ["Si", "ponéis", "paneles", "solares,", "pagaréis", "menos", "por", "la", "luz."], "key": "Si ponéis paneles solares, pagaréis menos por la luz."}, {"tokens": ["Si", "quiero", "ayudar,", "haré", "voluntariado", "el", "sábado."], "key": "Si quiero ayudar, haré voluntariado el sábado."}, {"tokens": ["Si", "sabemos", "más,", "querremos", "cuidar", "mejor", "la", "Tierra."], "key": "Si sabemos más, querremos cuidar mejor la Tierra."}];
const GLOSS = "tener → tendr- (to have); venir → vendr- (to come); poder → podr- (to be able); querer → querr- (to want); hacer → har- (to do/make); decir → dir- (to say/tell); poner → pondr- (to put/place); salir → saldr- (to leave/go out); saber → sabr- (to know (facts))";
const GLOSS_MAP = {"tener": "to have", "venir": "to come", "poder": "to be able", "querer": "to want", "hacer": "to do/make", "decir": "to say/tell", "poner": "to put/place", "salir": "to leave/go out", "saber": "to know (facts)"};

function buildS1(){
  const bank = document.querySelector('#s1Bank'); bank.innerHTML='';
  const all = shuffle(S1_GOOD.concat(S1_BAD));
  all.forEach(txt=>{ const sp=document.createElement('span'); sp.className='tile'; sp.textContent=txt; sp.draggable=true; sp.dataset.correct=S1_GOOD.includes(txt)?'good':'bad'; makeTileInteractive(sp); bank.appendChild(sp); });
  makeBinInteractive(document.querySelector('#s1Good')); makeBinInteractive(document.querySelector('#s1Bad'));
  document.querySelector('#s1Key').textContent='Futuro irregular: ' + S1_GOOD.join(' | ') + (teacherMode ? '  —  ' + GLOSS : '');
  document.querySelector('#s1Max').textContent = all.length;
}
function gradeS1(){
  const good=document.querySelector('#s1Good'), bad=document.querySelector('#s1Bad');
  let score=0; [good,bad].forEach(bin=>{ bin.querySelectorAll('.tile').forEach(t=>{ if((bin===good && t.dataset.correct==='good') || (bin===bad && t.dataset.correct==='bad')) score++; }); });
  document.querySelector('#s1Score').textContent=score; updateTotal();
}

function buildS2(){
  const cont=document.querySelector('#s2Container'); cont.innerHTML='';
  document.querySelector('#s2Max').textContent=S2_ITEMS.length;
  S2_ITEMS.forEach((it,idx)=>{
    const q=document.createElement('div'); q.className='q'; q.dataset.idx=idx;
    const drop=document.createElement('div'); drop.className='bin'; drop.style.minHeight='44px'; makeBinInteractive(drop);
    const prompt=document.createElement('div'); prompt.innerHTML='<strong>'+(idx+1)+'.</strong> ('+it.subj+') '+it.inf+' → '; prompt.appendChild(drop);
    const chips=document.createElement('div'); chips.className='chips';
    shuffle(it.opts).forEach(o=>{ const s=document.createElement('span'); s.className='tile'; s.textContent=o; s.setAttribute('data-val',o); s.draggable=true; makeTileInteractive(s); chips.appendChild(s); });
    const key=document.createElement('div'); key.className='key'; key.textContent='Modelo: '+it.ans + (teacherMode ? '  —  '+it.inf+' ('+GLOSS_MAP[it.inf]+')' : '');
    q.appendChild(prompt); q.appendChild(chips); q.appendChild(key); cont.appendChild(q);
  });
}
function gradeS2(){
  let score=0; document.querySelectorAll('#s2Container .q').forEach(q=>{ const idx=+q.dataset.idx; const ans=S2_ITEMS[idx].ans; const chosen=q.querySelector('.bin .tile'); if(chosen && chosen.getAttribute('data-val')===ans){score++; q.classList.add('correct'); q.classList.remove('incorrect');} else {q.classList.add('incorrect'); q.classList.remove('correct');} });
  document.querySelector('#s2Score').textContent=score; updateTotal();
}

function buildS3(){
  const c=document.querySelector('#s3Container'); c.innerHTML='';
  document.querySelector('#s3Max').textContent=S3_ITEMS.length;
  S3_ITEMS.forEach((it,idx)=>{
    const size=Math.max(it.ans.length+1,5);
    const q=document.createElement('div'); q.className='q'; q.dataset.idx=idx;
    const replaced = it.txt.replace('___', '<span class="inline-blank"><input type="text" class="s3in" data-idx="'+idx+'" size="'+size+'" placeholder="..." /></span>');
    q.innerHTML = '<strong>'+(idx+1)+'.</strong> ' + replaced + '<div class="key">Modelo: '+it.ans+'</div>';
    c.appendChild(q);
  });
}
function gradeS3(){
  let score=0;
  document.querySelectorAll('.s3in').forEach(inp=>{ const idx=+inp.dataset.idx; const val=norm(inp.value); const ans=norm(S3_ITEMS[idx].ans); const q=inp.closest('.q'); if(val===ans){score++; q.classList.add('correct'); q.classList.remove('incorrect');} else {q.classList.add('incorrect'); q.classList.remove('correct');} });
  document.querySelector('#s3Score').textContent=score; updateTotal();
}

function buildS4(){
  const c=document.querySelector('#s4Container'); c.innerHTML='';
  document.querySelector('#s4Max').textContent=S4_ITEMS.length;
  S4_ITEMS.forEach((it,idx)=>{
    const q=document.createElement('div'); q.className='q'; q.dataset.idx=idx;
    const bank=document.createElement('div'); bank.className='chips';
    shuffle(it.tokens).forEach(tok=>{ const s=document.createElement('span'); s.className='tile'; s.textContent=tok; s.draggable=true; makeTileInteractive(s); bank.appendChild(s); });
    const bin=document.createElement('div'); bin.className='bin'; makeBinInteractive(bin);
    const key=document.createElement('div'); key.className='key'; key.textContent='Modelo: '+it.key;
    q.innerHTML='<strong>'+(idx+1)+'.</strong> Ordena:';
    q.appendChild(bank); q.appendChild(bin); q.appendChild(key); c.appendChild(q);
  });
}
function gradeS4(){
  let score=0; document.querySelectorAll('#s4Container .q').forEach(q=>{ const idx=+q.dataset.idx; const expected=S4_ITEMS[idx].tokens; const got=Array.from(q.querySelectorAll('.bin .tile')).map(t=>t.textContent); if(got.length===expected.length && got.every((w,i)=>w===expected[i])){score++; q.classList.add('correct'); q.classList.remove('incorrect');} else {q.classList.add('incorrect'); q.classList.remove('correct');} });
  document.querySelector('#s4Score').textContent=score; updateTotal();
}

function updateTotal(){
  const s1=+document.querySelector('#s1Score').textContent||0;
  const s2=+document.querySelector('#s2Score').textContent||0;
  const s3=+document.querySelector('#s3Score').textContent||0;
  const s4=+document.querySelector('#s4Score').textContent||0;
  const m1=+document.querySelector('#s1Max').textContent||0;
  const m2=+document.querySelector('#s2Max').textContent||0;
  const m3=+document.querySelector('#s3Max').textContent||0;
  const m4=+document.querySelector('#s4Max').textContent||0;
  document.querySelector('#totalScore').textContent=s1+s2+s3+s4;
  document.querySelector('#totalMax').textContent=m1+m2+m3+m4;
}
function exportCSV(){
  const s1=+document.querySelector('#s1Score').textContent||0;
  const s2=+document.querySelector('#s2Score').textContent||0;
  const s3=+document.querySelector('#s3Score').textContent||0;
  const s4=+document.querySelector('#s4Score').textContent||0;
  const m1=+document.querySelector('#s1Max').textContent||0;
  const m2=+document.querySelector('#s2Max').textContent||0;
  const m3=+document.querySelector('#s3Max').textContent||0;
  const m4=+document.querySelector('#s4Max').textContent||0;
  exportCSVGeneric('future_irregular_results.csv','timestamp,name,s1,s1_max,s2,s2_max,s3,s3_max,s4,s4_max,total,total_max',[s1,m1,s2,m2,s3,m3,s4,m4,(s1+s2+s3+s4),(m1+m2+m3+m4)]);
}
function init(){
  buildS1(); buildS2(); buildS3(); buildS4(); applyTeacher();
  document.querySelector('#checkAll').addEventListener('click', ()=>{ gradeS1(); gradeS2(); gradeS3(); gradeS4(); });
  document.querySelector('#resetAll').addEventListener('click', ()=>{ location.reload(); });
  document.querySelector('#exportCSV').addEventListener('click', exportCSV);
} init();

</script>
</body></html>
